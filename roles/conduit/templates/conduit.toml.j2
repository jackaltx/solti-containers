# Conduit Matrix Homeserver Configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

[global]
# Server name (your Matrix domain)
server_name = "{{ conduit_server_name }}"

# Database backend (rocksdb is recommended)
database_backend = "{{ conduit_database_backend }}"

# Database path (inside container)
database_path = "/var/lib/matrix-conduit/"

# Port Conduit listens on (inside container)
# External access via reverse proxy (Traefik)
port = 6167

# Max size for uploads (in bytes)
max_request_size = {{ conduit_max_request_size }}

# Enable user registration
allow_registration = {{ conduit_allow_registration | lower }}

{% if conduit_registration_token %}
# Registration token required for new users
registration_token = "{{ conduit_registration_token }}"
{% endif %}

# Allow checking for updates
allow_check_for_updates = true

# Enable federation with other Matrix servers
allow_federation = {{ conduit_allow_federation | lower }}

# Enable lightning bolt on registration
enable_lightning_bolt = {{ conduit_enable_lightning_bolt | lower }}

# Trusted servers for gathering public keys
trusted_servers = [{{ conduit_trusted_servers | map('to_json') | join(', ') }}]

# Log level
log = "{{ conduit_log_level }}"

# Listen address
address = "{{ conduit_address }}"

{% if conduit_turn_uris | length > 0 %}
# TURN server configuration for VoIP
turn_uris = [{{ conduit_turn_uris | map('to_json') | join(', ') }}]
{% if conduit_turn_secret %}
turn_secret = "{{ conduit_turn_secret }}"
{% endif %}
{% endif %}

{% if conduit_well_known_client or conduit_well_known_server %}
# Well-known configuration for delegation
[global.well_known]
{% if conduit_well_known_client %}
client = "{{ conduit_well_known_client }}"
{% endif %}
{% if conduit_well_known_server %}
server = "{{ conduit_well_known_server }}"
{% endif %}
{% endif %}
